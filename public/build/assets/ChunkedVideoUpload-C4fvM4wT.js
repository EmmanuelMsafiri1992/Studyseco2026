import{r as l,E as Z,c as h,o as g,j as C,b as t,G as D,q as V,t as i,S as ee}from"./app-BwyiUpTk.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"chunked-upload-container"},ae={key:0,class:"upload-area"},oe={key:1,class:"mt-4 p-4 bg-slate-50 rounded-xl"},le={class:"flex items-center justify-between"},ne={class:"flex items-center space-x-3"},re={class:"font-medium text-slate-700"},ie={class:"text-sm text-slate-500"},de={key:2,class:"mt-4"},ue={class:"bg-white rounded-xl p-6 shadow-sm border"},ce={class:"flex items-center justify-between mb-4"},pe={class:"flex items-center space-x-3"},ve={class:"text-sm text-slate-600"},fe={class:"space-y-2"},me={class:"flex justify-between text-sm"},he={class:"font-medium"},ge={class:"w-full bg-slate-200 rounded-full h-3"},xe={class:"flex justify-between text-xs text-slate-500"},ke={key:3,class:"mt-4"},we={key:4,class:"mt-4"},ye={class:"bg-red-50 border border-red-200 rounded-xl p-4"},be={class:"flex items-center space-x-3"},Se={class:"text-sm text-red-600"},Ce={__name:"ChunkedVideoUpload",props:{maxFileSize:{type:Number,default:1024*1024*1024},chunkSize:{type:Number,default:1024*1024*5}},emits:["upload-success","upload-error","cancel"],setup(O,{emit:R}){const f=O,M=R,n=l(null),T=l(null),L=l(!1),K=l(0),d=l(!1),x=l(0),k=l(0),w=l(0),c=l(!1),r=l(""),p=l("");l(!1);const j=l(null),m=l(0),y=l(0),$=l("Calculating..."),_=l("Calculating..."),q=s=>{const e=s.target.files[0];e&&P(e)},X=s=>{const e=s.dataTransfer.files[0];e&&P(e)},P=s=>{if(!s.type.startsWith("video/")){r.value="Please select a valid video file";return}if(s.size>f.maxFileSize){r.value=`File size exceeds ${b(f.maxFileSize)} limit`;return}n.value=s,r.value="",c.value=!1},G=()=>{n.value=null,T.value=null,r.value="",c.value=!1},U=async()=>{if(n.value)try{r.value="",d.value=!0,j.value=Date.now(),y.value=n.value.size,m.value=0,await I(n.value)}catch(s){console.error("Upload error:",s),r.value=s.message||"Upload failed. Please try again.",d.value=!1,M("upload-error",s.message)}},I=async s=>{const e=Math.ceil(s.size/f.chunkSize);w.value=e;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!a)throw new Error("CSRF token not found. Please refresh the page.");const o=await fetch("/api/upload/initiate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({fileName:s.name,fileSize:s.size,chunkSize:f.chunkSize,totalChunks:e})});if(!o.ok)throw o.status===401?new Error("Session expired. Please refresh the page and try again."):o.status===419?new Error("CSRF token mismatch. Please refresh the page."):new Error(`Server error: ${o.status}`);const u=await o.json();if(!u.success)throw new Error(u.error||"Failed to initialize upload");p.value=u.uploadId,await J(s,e)},J=async(s,e)=>{for(let a=0;a<e;a++)await W(s,a);await new Promise(a=>setTimeout(a,500)),await H()},W=async(s,e)=>{const a=e*f.chunkSize,o=Math.min(a+f.chunkSize,s.size),u=s.slice(a,o);new File([u],`chunk_${e}`,{type:s.type||"application/octet-stream"});const E=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),z=new FormData;z.append("chunk",u,`chunk_${e}.bin`),z.append("chunkNumber",e.toString()),z.append("totalChunks",w.value.toString());const v=await fetch(`/api/upload/${p.value}/chunk`,{method:"POST",headers:{"X-CSRF-TOKEN":E,Accept:"application/json"},credentials:"same-origin",body:z});if(!v.ok){let B="";try{const S=await v.json();B=S.error||S.message||JSON.stringify(S),console.error("Chunk upload error response:",S)}catch{B=await v.text()}throw v.status===401||v.status===419?new Error("Session expired. Please refresh the page."):new Error(`Chunk ${e} upload failed: ${v.status} - ${B}`)}const F=await v.json();if(!F.success)throw new Error(F.error||"Chunk upload failed");k.value=F.uploadedChunks,x.value=F.progress,m.value=k.value/w.value*y.value,Y()},H=async()=>{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e=await fetch(`/api/upload/${p.value}/finalize`,{method:"POST",headers:{"X-CSRF-TOKEN":s,Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw e.status===401||e.status===419?new Error("Session expired. Please refresh the page."):new Error(`Finalization failed: ${e.status}`);const a=await e.json();if(!a.success)throw new Error(a.error||"Upload finalization failed");d.value=!1,c.value=!0,M("upload-success",{filePath:a.filePath,fileName:n.value.name,fileSize:a.fileSize,duration:a.duration,storageDisk:a.storage_disk||"public"})},A=async()=>{if(p.value)try{await fetch(`/api/upload/${p.value}/cancel`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})}catch(s){console.error("Cancel upload error:",s)}N(),M("cancel")},Q=()=>{r.value="",x.value=0,k.value=0,d.value=!1,U()},N=()=>{n.value=null,T.value=null,L.value=!1,K.value=0,d.value=!1,x.value=0,k.value=0,w.value=0,c.value=!1,r.value="",p.value="",m.value=0,y.value=0},b=s=>{if(s===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,o)).toFixed(2))+" "+a[o]},Y=()=>{if(!j.value)return;const s=(Date.now()-j.value)/1e3,e=m.value/s;$.value=`${b(e)}/s`;const o=(y.value-m.value)/e;if(isFinite(o))if(o<60)_.value=`${Math.round(o)}s`;else if(o<3600)_.value=`${Math.round(o/60)}m ${Math.round(o%60)}s`;else{const u=Math.floor(o/3600),E=Math.floor(o%3600/60);_.value=`${u}h ${E}m`}};return Z(()=>{p.value&&d.value&&A()}),(s,e)=>(g(),h("div",se,[!d.value&&!c.value?(g(),h("div",ae,[t("input",{ref:"fileInput",type:"file",accept:"video/*",onChange:q,class:"hidden"},null,544),t("div",{onClick:e[0]||(e[0]=a=>s.$refs.fileInput.click()),onDragover:e[1]||(e[1]=V(()=>{},["prevent"])),onDrop:V(X,["prevent"]),class:"border-2 border-dashed border-slate-300 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all duration-200"},[...e[2]||(e[2]=[D('<div class="flex flex-col items-center space-y-4" data-v-d6def02e><svg class="w-12 h-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-d6def02e><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-d6def02e></path></svg><div data-v-d6def02e><p class="text-lg font-semibold text-slate-700" data-v-d6def02e>Click to upload or drag and drop</p><p class="text-sm text-slate-500 mt-1" data-v-d6def02e>Supports MP4, MOV, AVI, WMV, MKV up to 1GB</p><p class="text-xs text-slate-400 mt-2" data-v-d6def02e>Fast chunked upload with compression</p></div></div>',1)])],32)])):C("",!0),n.value&&!d.value&&!c.value?(g(),h("div",oe,[t("div",le,[t("div",ne,[e[3]||(e[3]=t("div",{class:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})])],-1)),t("div",null,[t("p",re,i(n.value.name),1),t("p",ie,i(b(n.value.size)),1)])]),t("div",{class:"flex items-center space-x-2"},[t("button",{onClick:U,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200"}," Start Upload "),t("button",{onClick:G,class:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors duration-200"}," Cancel ")])])])):C("",!0),d.value?(g(),h("div",de,[t("div",ue,[t("div",ce,[t("div",pe,[e[5]||(e[5]=t("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},[t("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})])],-1)),t("div",null,[e[4]||(e[4]=t("p",{class:"font-semibold text-slate-800"},"Uploading Video...",-1)),t("p",ve,i(k.value)+"/"+i(w.value)+" chunks â€¢ "+i($.value),1)])]),t("button",{onClick:A,class:"text-red-600 hover:text-red-700 text-sm font-medium"}," Cancel ")]),t("div",fe,[t("div",me,[e[6]||(e[6]=t("span",{class:"text-slate-600"},"Progress",-1)),t("span",he,i(x.value.toFixed(1))+"%",1)]),t("div",ge,[t("div",{class:"bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-300",style:ee({width:x.value+"%"})},null,4)]),t("div",xe,[t("span",null,i(b(m.value))+" / "+i(b(y.value)),1),t("span",null,"ETA: "+i(_.value),1)])])])])):C("",!0),c.value?(g(),h("div",ke,[t("div",{class:"bg-green-50 border border-green-200 rounded-xl p-6"},[e[7]||(e[7]=D('<div class="flex items-center space-x-3" data-v-d6def02e><div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" data-v-d6def02e><svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-d6def02e><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-d6def02e></path></svg></div><div data-v-d6def02e><p class="font-semibold text-green-800" data-v-d6def02e>Upload Successful!</p><p class="text-sm text-green-600" data-v-d6def02e>Video uploaded and processed successfully</p></div></div>',1)),t("button",{onClick:N,class:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium"}," Upload Another Video ")])])):C("",!0),r.value?(g(),h("div",we,[t("div",ye,[t("div",be,[e[9]||(e[9]=t("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.126 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t("div",null,[e[8]||(e[8]=t("p",{class:"font-medium text-red-800"},"Upload Failed",-1)),t("p",Se,i(r.value),1)])]),t("button",{onClick:Q,class:"mt-2 text-sm text-red-700 hover:text-red-800 font-medium"}," Try Again ")])])):C("",!0)]))}},Fe=te(Ce,[["__scopeId","data-v-d6def02e"]]);export{Fe as C};
