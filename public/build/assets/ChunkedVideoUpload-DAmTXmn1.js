import{r as l,E as Y,c as m,o as h,j as S,b as t,G as A,q as N,t as i,S as Z}from"./app-CExNfixo.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"chunked-upload-container"},se={key:0,class:"upload-area"},ae={key:1,class:"mt-4 p-4 bg-slate-50 rounded-xl"},oe={class:"flex items-center justify-between"},le={class:"flex items-center space-x-3"},ne={class:"font-medium text-slate-700"},re={class:"text-sm text-slate-500"},ie={key:2,class:"mt-4"},de={class:"bg-white rounded-xl p-6 shadow-sm border"},ue={class:"flex items-center justify-between mb-4"},ce={class:"flex items-center space-x-3"},pe={class:"text-sm text-slate-600"},ve={class:"space-y-2"},fe={class:"flex justify-between text-sm"},me={class:"font-medium"},he={class:"w-full bg-slate-200 rounded-full h-3"},ge={class:"flex justify-between text-xs text-slate-500"},xe={key:3,class:"mt-4"},ke={key:4,class:"mt-4"},we={class:"bg-red-50 border border-red-200 rounded-xl p-4"},be={class:"flex items-center space-x-3"},ye={class:"text-sm text-red-600"},Se={__name:"ChunkedVideoUpload",props:{maxFileSize:{type:Number,default:1024*1024*1024},chunkSize:{type:Number,default:1024*1024*5}},emits:["upload-success","upload-error","cancel"],setup(V,{emit:D}){const v=V,F=D,n=l(null),j=l(null),O=l(!1),R=l(0),d=l(!1),g=l(0),x=l(0),k=l(0),u=l(!1),r=l(""),c=l("");l(!1);const M=l(null),f=l(0),w=l(0),B=l("Calculating..."),C=l("Calculating..."),L=s=>{const e=s.target.files[0];e&&T(e)},K=s=>{const e=s.dataTransfer.files[0];e&&T(e)},T=s=>{if(!s.type.startsWith("video/")){r.value="Please select a valid video file";return}if(s.size>v.maxFileSize){r.value=`File size exceeds ${b(v.maxFileSize)} limit`;return}n.value=s,r.value="",u.value=!1},q=()=>{n.value=null,j.value=null,r.value="",u.value=!1},$=async()=>{if(n.value)try{r.value="",d.value=!0,M.value=Date.now(),w.value=n.value.size,f.value=0,await X(n.value)}catch(s){console.error("Upload error:",s),r.value=s.message||"Upload failed. Please try again.",d.value=!1,F("upload-error",s.message)}},X=async s=>{const e=Math.ceil(s.size/v.chunkSize);k.value=e;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!a)throw new Error("CSRF token not found. Please refresh the page.");const o=await fetch("/api/upload/initiate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({fileName:s.name,fileSize:s.size,chunkSize:v.chunkSize,totalChunks:e})});if(!o.ok)throw o.status===401?new Error("Session expired. Please refresh the page and try again."):o.status===419?new Error("CSRF token mismatch. Please refresh the page."):new Error(`Server error: ${o.status}`);const p=await o.json();if(!p.success)throw new Error(p.error||"Failed to initialize upload");c.value=p.uploadId,await G(s,e)},G=async(s,e)=>{for(let a=0;a<e;a++)await I(s,a);await new Promise(a=>setTimeout(a,500)),await W()},I=async(s,e)=>{const a=e*v.chunkSize,o=Math.min(a+v.chunkSize,s.size),p=s.slice(a,o),E=new File([p],`chunk_${e}`,{type:s.type||"application/octet-stream"}),Q=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),_=new FormData;_.append("chunk",E,`chunk_${e}`),_.append("chunkNumber",String(e)),_.append("totalChunks",String(k.value));const y=await fetch(`/api/upload/${c.value}/chunk`,{method:"POST",headers:{"X-CSRF-TOKEN":Q,Accept:"application/json"},credentials:"same-origin",body:_});if(!y.ok)throw y.status===401||y.status===419?new Error("Session expired. Please refresh the page."):new Error(`Chunk ${e} upload failed: ${y.status}`);const z=await y.json();if(!z.success)throw new Error(z.error||"Chunk upload failed");x.value=z.uploadedChunks,g.value=z.progress,f.value=x.value/k.value*w.value,J()},W=async()=>{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e=await fetch(`/api/upload/${c.value}/finalize`,{method:"POST",headers:{"X-CSRF-TOKEN":s,Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw e.status===401||e.status===419?new Error("Session expired. Please refresh the page."):new Error(`Finalization failed: ${e.status}`);const a=await e.json();if(!a.success)throw new Error(a.error||"Upload finalization failed");d.value=!1,u.value=!0,F("upload-success",{filePath:a.filePath,fileName:n.value.name,fileSize:a.fileSize,duration:a.duration,storageDisk:a.storage_disk||"public"})},P=async()=>{if(c.value)try{await fetch(`/api/upload/${c.value}/cancel`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})}catch(s){console.error("Cancel upload error:",s)}U(),F("cancel")},H=()=>{r.value="",g.value=0,x.value=0,d.value=!1,$()},U=()=>{n.value=null,j.value=null,O.value=!1,R.value=0,d.value=!1,g.value=0,x.value=0,k.value=0,u.value=!1,r.value="",c.value="",f.value=0,w.value=0},b=s=>{if(s===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,o)).toFixed(2))+" "+a[o]},J=()=>{if(!M.value)return;const s=(Date.now()-M.value)/1e3,e=f.value/s;B.value=`${b(e)}/s`;const o=(w.value-f.value)/e;if(isFinite(o))if(o<60)C.value=`${Math.round(o)}s`;else if(o<3600)C.value=`${Math.round(o/60)}m ${Math.round(o%60)}s`;else{const p=Math.floor(o/3600),E=Math.floor(o%3600/60);C.value=`${p}h ${E}m`}};return Y(()=>{c.value&&d.value&&P()}),(s,e)=>(h(),m("div",te,[!d.value&&!u.value?(h(),m("div",se,[t("input",{ref:"fileInput",type:"file",accept:"video/*",onChange:L,class:"hidden"},null,544),t("div",{onClick:e[0]||(e[0]=a=>s.$refs.fileInput.click()),onDragover:e[1]||(e[1]=N(()=>{},["prevent"])),onDrop:N(K,["prevent"]),class:"border-2 border-dashed border-slate-300 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all duration-200"},[...e[2]||(e[2]=[A('<div class="flex flex-col items-center space-y-4" data-v-2b442969><svg class="w-12 h-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-2b442969><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-2b442969></path></svg><div data-v-2b442969><p class="text-lg font-semibold text-slate-700" data-v-2b442969>Click to upload or drag and drop</p><p class="text-sm text-slate-500 mt-1" data-v-2b442969>Supports MP4, MOV, AVI, WMV, MKV up to 1GB</p><p class="text-xs text-slate-400 mt-2" data-v-2b442969>Fast chunked upload with compression</p></div></div>',1)])],32)])):S("",!0),n.value&&!d.value&&!u.value?(h(),m("div",ae,[t("div",oe,[t("div",le,[e[3]||(e[3]=t("div",{class:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})])],-1)),t("div",null,[t("p",ne,i(n.value.name),1),t("p",re,i(b(n.value.size)),1)])]),t("div",{class:"flex items-center space-x-2"},[t("button",{onClick:$,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200"}," Start Upload "),t("button",{onClick:q,class:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors duration-200"}," Cancel ")])])])):S("",!0),d.value?(h(),m("div",ie,[t("div",de,[t("div",ue,[t("div",ce,[e[5]||(e[5]=t("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},[t("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})])],-1)),t("div",null,[e[4]||(e[4]=t("p",{class:"font-semibold text-slate-800"},"Uploading Video...",-1)),t("p",pe,i(x.value)+"/"+i(k.value)+" chunks â€¢ "+i(B.value),1)])]),t("button",{onClick:P,class:"text-red-600 hover:text-red-700 text-sm font-medium"}," Cancel ")]),t("div",ve,[t("div",fe,[e[6]||(e[6]=t("span",{class:"text-slate-600"},"Progress",-1)),t("span",me,i(g.value.toFixed(1))+"%",1)]),t("div",he,[t("div",{class:"bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-300",style:Z({width:g.value+"%"})},null,4)]),t("div",ge,[t("span",null,i(b(f.value))+" / "+i(b(w.value)),1),t("span",null,"ETA: "+i(C.value),1)])])])])):S("",!0),u.value?(h(),m("div",xe,[t("div",{class:"bg-green-50 border border-green-200 rounded-xl p-6"},[e[7]||(e[7]=A('<div class="flex items-center space-x-3" data-v-2b442969><div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" data-v-2b442969><svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-2b442969><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-2b442969></path></svg></div><div data-v-2b442969><p class="font-semibold text-green-800" data-v-2b442969>Upload Successful!</p><p class="text-sm text-green-600" data-v-2b442969>Video uploaded and processed successfully</p></div></div>',1)),t("button",{onClick:U,class:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium"}," Upload Another Video ")])])):S("",!0),r.value?(h(),m("div",ke,[t("div",we,[t("div",be,[e[9]||(e[9]=t("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.126 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t("div",null,[e[8]||(e[8]=t("p",{class:"font-medium text-red-800"},"Upload Failed",-1)),t("p",ye,i(r.value),1)])]),t("button",{onClick:H,class:"mt-2 text-sm text-red-700 hover:text-red-800 font-medium"}," Try Again ")])])):S("",!0)]))}},ze=ee(Se,[["__scopeId","data-v-2b442969"]]);export{ze as C};
