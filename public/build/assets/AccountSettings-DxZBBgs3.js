import{p as z,z as b,A,K as F,x as v,r as y,c as u,o as d,a as x,u as r,h as N,w as U,b as e,j as p,q as h,t as m,d as g,v as f,n as T,i as w,g as B,F as q}from"./app-PgZLZy6T.js";import{_ as G}from"./DashboardLayout-Cf8-137X.js";const L={class:"max-w-4xl mx-auto"},R={class:"bg-white rounded-xl shadow-sm p-8"},V={class:"space-y-6"},D={class:"flex items-center space-x-6"},O={class:"shrink-0"},$=["src","alt"],I={class:"flex-1"},K={key:0,class:"mt-1 text-sm text-red-600"},W={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},J={key:0,class:"mt-1 text-sm text-red-600"},H={key:0,class:"mt-1 text-sm text-red-600"},Y={key:0,class:"mt-1 text-sm text-red-600"},Z={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},X={class:"px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg flex items-center justify-between"},Q={class:"text-gray-900 capitalize"},ee={class:"px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg"},te={class:"text-gray-900"},oe={class:"px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg"},le={class:"font-medium text-gray-900 capitalize"},re={key:0,class:"space-y-6"},se={key:0,class:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6"},ae={class:"flex items-center justify-between mb-4"},ne={class:"text-lg font-semibold text-gray-900"},ie={class:"text-sm text-gray-600"},ue={class:"flex items-center space-x-2"},de={key:0,class:"px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full"},me={key:1,class:"px-3 py-1 bg-purple-100 text-purple-800 text-sm font-medium rounded-full"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce={class:"bg-white rounded-lg p-4"},ge={class:"text-xl font-bold text-gray-900"},fe={class:"bg-white rounded-lg p-4"},be={class:"text-xl font-bold text-gray-900"},ve={class:"bg-white rounded-lg p-4"},ye={key:0,class:"mt-6 pt-4 border-t border-blue-200"},xe={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center"},he={class:"mt-8 flex justify-end"},we=["disabled"],ke={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Se={class:"flex items-center justify-between mb-6"},Ce={class:"space-y-4"},_e={class:"flex justify-end space-x-4 mt-6"},Pe={__name:"AccountSettings",props:{auth:Object,enrollment:Object,enrollmentStatus:Object},setup(a){const n=a.auth?.user||{name:"Guest",role:"guest",profile_photo_url:null},o=z({name:n.name||"",email:n.email||"",password:"",profile_photo:null,_method:"patch"});o.name&&o.email&&o.clearErrors(["name","email"]),b(()=>o.name,s=>{s&&o.errors.name&&o.clearErrors("name")}),b(()=>o.email,s=>{s&&o.errors.email&&o.clearErrors("email")}),A(async()=>{await F(),o.clearErrors(),n.name&&!o.name&&(o.name=n.name),n.email&&!o.email&&(o.email=n.email),setTimeout(()=>{o.name&&o.email&&o.clearErrors(["name","email"])},100)});const k=v(()=>o.errors.name&&(!o.name||o.name.trim()==="")),S=v(()=>o.errors.email&&(!o.email||o.email.trim()==="")),C=s=>{const t=s.target.files[0];if(console.log("File selected:",t?{name:t.name,size:t.size,type:t.type,lastModified:t.lastModified}:"No file"),t){const P=["image/jpeg","image/jpg","image/png","image/gif"];if(t.size>2097152){alert("File size must be less than 2MB");return}if(!P.includes(t.type)){alert("Please select a valid image file (JPG, PNG, GIF)");return}o.profile_photo=t,console.log("File set to form.profile_photo:",o.profile_photo)}else o.profile_photo=null},_=()=>{const s=n.name||o.name||"",t=n.email||o.email||"";console.log("Form data before submission:",{name:s,email:t,password:o.password?"***":"",profile_photo:o.profile_photo?{name:o.profile_photo.name,size:o.profile_photo.size,type:o.profile_photo.type,lastModified:o.profile_photo.lastModified}:null,hasFile:!!o.profile_photo}),o.clearErrors(),o.password,o.profile_photo,o.name=s,o.email=t,o._method="patch",o.post(route("profile.update"),{forceFormData:!0,preserveScroll:!0,onStart:()=>{o.clearErrors(),console.log("Starting profile update request with form data:",{name:o.name,email:o.email,password:o.password?"***":"",profile_photo:o.profile_photo?"File selected":null})},onSuccess:l=>{console.log("Profile update successful",l),o.reset("password"),o.clearErrors(),window.location.reload()},onError:l=>{console.error("Profile update errors:",l),s&&o.errors.name&&o.clearErrors("name"),t&&o.errors.email&&o.clearErrors("email")},onFinish:()=>{console.log("Profile update request finished"),s&&t&&o.clearErrors(["name","email"])}})},c=y(!1),i=y({new_country:"",new_phone:"",reason:"",verification_document:null}),E=()=>{window.location.href="/payments/create?upgrade=true"},M=s=>{const t={malawi:"TNM Mpamba, Airtel Money, Bank Transfer","south africa":"Mukuru, Hello Paisa",international:"WorldRemit, Remitly, Western Union, MoneyGram, PayPal"},l=s?.toLowerCase().replace(/\s+/g," ");return l==="malawi"||l==="south africa"?t[l]:t.international},j=()=>{if(!i.value.new_country||!i.value.new_phone||!i.value.reason){alert("Please fill in all required fields");return}const s=new FormData;Object.keys(i.value).forEach(t=>{i.value[t]&&s.append(t,i.value[t])}),fetch("/profile/country-update",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:s}).then(t=>t.json()).then(t=>{t.success?(c.value=!1,alert("Country update request submitted! Admin will review within 24-48 hours."),i.value={new_country:"",new_phone:"",reason:"",verification_document:null}):alert(t.message||"Error submitting request")}).catch(t=>{console.error("Error:",t),alert("Error submitting request. Please try again.")})};return(s,t)=>(d(),u(q,null,[x(r(N),{title:"Account Settings"}),x(G,{title:"Account Settings",subtitle:"Update your profile information"},{default:U(()=>[e("div",L,[e("div",R,[e("form",{onSubmit:h(_,["prevent"])},[e("div",V,[e("div",D,[e("div",O,[e("img",{src:r(n).profile_photo_url?`/storage/${r(n).profile_photo_url}`:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face&facepad=2&bg=white",alt:r(n).name,class:"h-20 w-20 rounded-full object-cover ring-4 ring-white shadow-lg"},null,8,$)]),e("div",I,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Profile Photo",-1)),e("input",{type:"file",onChange:C,accept:"image/*",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),t[13]||(t[13]=e("p",{class:"mt-1 text-sm text-gray-600"},"JPG, PNG, GIF up to 2MB",-1)),r(o).errors.profile_photo?(d(),u("div",K,m(r(o).errors.profile_photo),1)):p("",!0)])]),t[32]||(t[32]=e("hr",{class:"border-gray-200"},null,-1)),e("div",W,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Full Name",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>r(o).name=l),type:"text",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name"},null,512),[[f,r(o).name]]),k.value?(d(),u("div",J,m(r(o).errors.name),1)):p("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email Address",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>r(o).email=l),type:"email",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"},null,512),[[f,r(o).email]]),S.value?(d(),u("div",H,m(r(o).errors.email),1)):p("",!0)])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"New Password (optional)",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>r(o).password=l),type:"password",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Leave blank to keep current password"},null,512),[[f,r(o).password]]),t[17]||(t[17]=e("p",{class:"mt-1 text-sm text-gray-600"},"Leave blank to keep your current password",-1)),r(o).errors.password?(d(),u("div",Y,m(r(o).errors.password),1)):p("",!0)]),e("div",Z,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Current Country",-1)),e("div",X,[e("div",null,[e("p",Q,m(a.enrollmentStatus?.country||r(n).country||"Not Set"),1),t[18]||(t[18]=e("p",{class:"text-xs text-gray-500"},"Registered country for payment methods",-1))]),a.enrollmentStatus?.country?(d(),u("button",{key:0,onClick:t[3]||(t[3]=l=>c.value=!0),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Update ")):p("",!0)])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Available Payment Methods",-1)),e("div",ee,[e("p",te,m(M(a.enrollmentStatus?.country)),1),t[20]||(t[20]=e("p",{class:"text-xs text-gray-500"},"Based on your registered country",-1))])])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Account Type",-1)),e("div",oe,[e("span",le,m(r(n).role),1)]),t[23]||(t[23]=e("p",{class:"mt-1 text-sm text-gray-600"},"Your account type cannot be changed",-1))]),r(n).role==="student"?(d(),u("div",re,[t[31]||(t[31]=e("hr",{class:"border-gray-200"},null,-1)),e("div",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Enrollment Status",-1)),a.enrollmentStatus?(d(),u("div",se,[e("div",ae,[e("div",null,[e("h4",ne,m(a.enrollmentStatus.is_trial?"Free Trial Account":"Premium Account"),1),e("p",ie,m(a.enrollmentStatus.is_trial?"7 Days Free Trial":"Full Access Account"),1)]),e("div",ue,[a.enrollmentStatus.is_trial?(d(),u("span",de," ðŸ†“ Trial ")):(d(),u("span",me," â­ Premium "))])]),e("div",pe,[e("div",ce,[t[24]||(t[24]=e("div",{class:"text-sm text-gray-600"},"Subjects Enrolled",-1)),e("div",ge,m(a.enrollmentStatus.subjects_count),1)]),e("div",fe,[t[25]||(t[25]=e("div",{class:"text-sm text-gray-600"},"Access Remaining",-1)),e("div",be,m(a.enrollmentStatus.access_days_remaining)+" days",1)]),e("div",ve,[t[26]||(t[26]=e("div",{class:"text-sm text-gray-600"},"Status",-1)),e("div",{class:T(["text-xl font-bold capitalize",{"text-green-600":a.enrollmentStatus.status==="approved","text-yellow-600":a.enrollmentStatus.status==="pending","text-red-600":a.enrollmentStatus.status==="rejected"}])},m(a.enrollmentStatus.status),3)])]),a.enrollmentStatus.is_trial?(d(),u("div",ye,[e("div",{class:"flex items-center justify-between"},[t[28]||(t[28]=e("div",null,[e("h5",{class:"font-semibold text-gray-900 mb-1"},"Ready to upgrade?"),e("p",{class:"text-sm text-gray-600"},"Get unlimited access to all subjects and features")],-1)),e("button",{onClick:E,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all duration-200"},[...t[27]||(t[27]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})],-1),w(" Upgrade to Premium ",-1)])])])])):p("",!0)])):(d(),u("div",xe,[...t[29]||(t[29]=[e("div",{class:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1),e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"No Active Enrollment",-1),e("p",{class:"text-gray-600 mb-4"},"You haven't enrolled in any subjects yet.",-1),e("a",{href:"/student/enrollment",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Start Learning Journey ",-1)])]))])])):p("",!0)]),e("div",he,[e("button",{type:"submit",disabled:r(o).processing,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r(o).processing?(d(),u("svg",ke,[...t[33]||(t[33]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):p("",!0),w(" "+m(r(o).processing?"Updating...":"Update Profile"),1)],8,we)])],32)])]),c.value?(d(),u("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:t[11]||(t[11]=l=>c.value=!1)},[e("div",{class:"bg-white rounded-2xl p-6 max-w-md w-full mx-4",onClick:t[10]||(t[10]=h(()=>{},["stop"]))},[e("div",Se,[t[35]||(t[35]=e("h2",{class:"text-xl font-bold text-gray-900"},"Update Country",-1)),e("button",{onClick:t[4]||(t[4]=l=>c.value=!1),class:"w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center"},[...t[34]||(t[34]=[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ce,[t[43]||(t[43]=e("div",{class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},[e("div",{class:"flex items-start"},[e("svg",{class:"w-5 h-5 text-amber-600 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})]),e("div",null,[e("p",{class:"text-sm font-medium text-amber-800"},"Country Change Request"),e("p",{class:"text-xs text-amber-700 mt-1"},"Requires admin approval and phone verification. Process takes 24-48 hours.")])])],-1)),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"New Country",-1)),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>i.value.new_country=l),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...t[36]||(t[36]=[e("option",{value:""},"Select your new country",-1),e("optgroup",{label:"ðŸŒ Southern Africa"},[e("option",{value:"malawi"},"Malawi"),e("option",{value:"south_africa"},"South Africa"),e("option",{value:"botswana"},"Botswana"),e("option",{value:"zimbabwe"},"Zimbabwe"),e("option",{value:"zambia"},"Zambia"),e("option",{value:"namibia"},"Namibia"),e("option",{value:"lesotho"},"Lesotho"),e("option",{value:"eswatini"},"Eswatini (Swaziland)"),e("option",{value:"mozambique"},"Mozambique")],-1),e("optgroup",{label:"ðŸŒ East Africa"},[e("option",{value:"kenya"},"Kenya"),e("option",{value:"tanzania"},"Tanzania"),e("option",{value:"uganda"},"Uganda"),e("option",{value:"rwanda"},"Rwanda"),e("option",{value:"ethiopia"},"Ethiopia"),e("option",{value:"burundi"},"Burundi"),e("option",{value:"south_sudan"},"South Sudan"),e("option",{value:"djibouti"},"Djibouti"),e("option",{value:"eritrea"},"Eritrea"),e("option",{value:"somalia"},"Somalia")],-1),e("optgroup",{label:"ðŸŒ West Africa"},[e("option",{value:"nigeria"},"Nigeria"),e("option",{value:"ghana"},"Ghana"),e("option",{value:"senegal"},"Senegal"),e("option",{value:"ivory_coast"},"Ivory Coast (CÃ´te d'Ivoire)"),e("option",{value:"burkina_faso"},"Burkina Faso"),e("option",{value:"mali"},"Mali"),e("option",{value:"niger"},"Niger"),e("option",{value:"guinea"},"Guinea"),e("option",{value:"benin"},"Benin"),e("option",{value:"togo"},"Togo"),e("option",{value:"liberia"},"Liberia"),e("option",{value:"sierra_leone"},"Sierra Leone"),e("option",{value:"gambia"},"The Gambia"),e("option",{value:"guinea_bissau"},"Guinea-Bissau"),e("option",{value:"cape_verde"},"Cape Verde")],-1),e("optgroup",{label:"ðŸŒ Central Africa"},[e("option",{value:"cameroon"},"Cameroon"),e("option",{value:"democratic_republic_congo"},"Democratic Republic of Congo"),e("option",{value:"republic_congo"},"Republic of Congo"),e("option",{value:"central_african_republic"},"Central African Republic"),e("option",{value:"chad"},"Chad"),e("option",{value:"gabon"},"Gabon"),e("option",{value:"equatorial_guinea"},"Equatorial Guinea"),e("option",{value:"sao_tome_principe"},"SÃ£o TomÃ© and PrÃ­ncipe")],-1),e("optgroup",{label:"ðŸŒ North Africa"},[e("option",{value:"egypt"},"Egypt"),e("option",{value:"libya"},"Libya"),e("option",{value:"tunisia"},"Tunisia"),e("option",{value:"algeria"},"Algeria"),e("option",{value:"morocco"},"Morocco"),e("option",{value:"sudan"},"Sudan")],-1),e("optgroup",{label:"ðŸŒ Island Nations"},[e("option",{value:"madagascar"},"Madagascar"),e("option",{value:"mauritius"},"Mauritius"),e("option",{value:"seychelles"},"Seychelles"),e("option",{value:"comoros"},"Comoros")],-1),e("optgroup",{label:"ðŸŒŽ Other Regions"},[e("option",{value:"united_states"},"United States"),e("option",{value:"united_kingdom"},"United Kingdom"),e("option",{value:"canada"},"Canada"),e("option",{value:"australia"},"Australia"),e("option",{value:"other"},"Other Country")],-1)])],512),[[B,i.value.new_country]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"New Phone Number",-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>i.value.new_phone=l),type:"tel",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number in new country"},null,512),[[f,i.value.new_phone]]),t[39]||(t[39]=e("p",{class:"text-xs text-gray-500 mt-1"},"We'll send SMS verification to this number",-1))]),e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reason for Change",-1)),g(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>i.value.reason=l),rows:"3",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Explain why you need to change your country"},null,512),[[f,i.value.reason]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Verification Document (Optional)",-1)),e("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:t[8]||(t[8]=l=>i.value.verification_document=l.target.files[0]),class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"},null,32),t[42]||(t[42]=e("p",{class:"text-xs text-gray-500 mt-1"},"Upload proof of residence in new country (optional)",-1))])]),e("div",_e,[e("button",{onClick:t[9]||(t[9]=l=>c.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," Cancel "),e("button",{onClick:j,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Submit Request ")])])])):p("",!0)]),_:1})],64))}};export{Pe as default};
