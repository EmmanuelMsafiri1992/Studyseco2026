import{r as l,E as Q,c as m,o as h,j as S,b as t,G as A,q as N,t as i,S as Y}from"./app-Bi-rE304.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"chunked-upload-container"},te={key:0,class:"upload-area"},ae={key:1,class:"mt-4 p-4 bg-slate-50 rounded-xl"},se={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-3"},le={class:"font-medium text-slate-700"},ne={class:"text-sm text-slate-500"},re={key:2,class:"mt-4"},ie={class:"bg-white rounded-xl p-6 shadow-sm border"},de={class:"flex items-center justify-between mb-4"},ue={class:"flex items-center space-x-3"},ce={class:"text-sm text-slate-600"},pe={class:"space-y-2"},ve={class:"flex justify-between text-sm"},fe={class:"font-medium"},me={class:"w-full bg-slate-200 rounded-full h-3"},he={class:"flex justify-between text-xs text-slate-500"},ge={key:3,class:"mt-4"},xe={key:4,class:"mt-4"},ke={class:"bg-red-50 border border-red-200 rounded-xl p-4"},we={class:"flex items-center space-x-3"},ye={class:"text-sm text-red-600"},be={__name:"ChunkedVideoUpload",props:{maxFileSize:{type:Number,default:1024*1024*1024},chunkSize:{type:Number,default:1024*1024*5}},emits:["upload-success","upload-error","cancel"],setup(V,{emit:D}){const v=V,F=D,n=l(null),j=l(null),O=l(!1),R=l(0),d=l(!1),g=l(0),x=l(0),k=l(0),u=l(!1),r=l(""),c=l("");l(!1);const M=l(null),f=l(0),w=l(0),T=l("Calculating..."),C=l("Calculating..."),L=a=>{const e=a.target.files[0];e&&B(e)},K=a=>{const e=a.dataTransfer.files[0];e&&B(e)},B=a=>{if(!a.type.startsWith("video/")){r.value="Please select a valid video file";return}if(a.size>v.maxFileSize){r.value=`File size exceeds ${y(v.maxFileSize)} limit`;return}n.value=a,r.value="",u.value=!1},q=()=>{n.value=null,j.value=null,r.value="",u.value=!1},P=async()=>{if(n.value)try{r.value="",d.value=!0,M.value=Date.now(),w.value=n.value.size,f.value=0,await I(n.value)}catch(a){console.error("Upload error:",a),r.value=a.message||"Upload failed. Please try again.",d.value=!1,F("upload-error",a.message)}},I=async a=>{const e=Math.ceil(a.size/v.chunkSize);k.value=e;const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!s)throw new Error("CSRF token not found. Please refresh the page.");const o=await fetch("/api/upload/initiate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({fileName:a.name,fileSize:a.size,chunkSize:v.chunkSize,totalChunks:e})});if(!o.ok)throw o.status===401?new Error("Session expired. Please refresh the page and try again."):o.status===419?new Error("CSRF token mismatch. Please refresh the page."):new Error(`Server error: ${o.status}`);const p=await o.json();if(!p.success)throw new Error(p.error||"Failed to initialize upload");c.value=p.uploadId,await X(a,e)},X=async(a,e)=>{for(let s=0;s<e;s++)await G(a,s);await new Promise(s=>setTimeout(s,500)),await W()},G=async(a,e)=>{const s=e*v.chunkSize,o=Math.min(s+v.chunkSize,a.size),p=a.slice(s,o),E=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),_=new FormData;_.append("chunk",p),_.append("chunkNumber",e),_.append("totalChunks",k.value);const b=await fetch(`/api/upload/${c.value}/chunk`,{method:"POST",headers:{"X-CSRF-TOKEN":E,Accept:"application/json"},credentials:"same-origin",body:_});if(!b.ok)throw b.status===401||b.status===419?new Error("Session expired. Please refresh the page."):new Error(`Chunk ${e} upload failed: ${b.status}`);const z=await b.json();if(!z.success)throw new Error(z.error||"Chunk upload failed");x.value=z.uploadedChunks,g.value=z.progress,f.value=x.value/k.value*w.value,J()},W=async()=>{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e=await fetch(`/api/upload/${c.value}/finalize`,{method:"POST",headers:{"X-CSRF-TOKEN":a,Accept:"application/json"},credentials:"same-origin"});if(!e.ok)throw e.status===401||e.status===419?new Error("Session expired. Please refresh the page."):new Error(`Finalization failed: ${e.status}`);const s=await e.json();if(!s.success)throw new Error(s.error||"Upload finalization failed");d.value=!1,u.value=!0,F("upload-success",{filePath:s.filePath,fileName:n.value.name,fileSize:s.fileSize,duration:s.duration,storageDisk:s.storage_disk||"public"})},U=async()=>{if(c.value)try{await fetch(`/api/upload/${c.value}/cancel`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})}catch(a){console.error("Cancel upload error:",a)}$(),F("cancel")},H=()=>{r.value="",g.value=0,x.value=0,d.value=!1,P()},$=()=>{n.value=null,j.value=null,O.value=!1,R.value=0,d.value=!1,g.value=0,x.value=0,k.value=0,u.value=!1,r.value="",c.value="",f.value=0,w.value=0},y=a=>{if(a===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,o)).toFixed(2))+" "+s[o]},J=()=>{if(!M.value)return;const a=(Date.now()-M.value)/1e3,e=f.value/a;T.value=`${y(e)}/s`;const o=(w.value-f.value)/e;if(isFinite(o))if(o<60)C.value=`${Math.round(o)}s`;else if(o<3600)C.value=`${Math.round(o/60)}m ${Math.round(o%60)}s`;else{const p=Math.floor(o/3600),E=Math.floor(o%3600/60);C.value=`${p}h ${E}m`}};return Q(()=>{c.value&&d.value&&U()}),(a,e)=>(h(),m("div",ee,[!d.value&&!u.value?(h(),m("div",te,[t("input",{ref:"fileInput",type:"file",accept:"video/*",onChange:L,class:"hidden"},null,544),t("div",{onClick:e[0]||(e[0]=s=>a.$refs.fileInput.click()),onDragover:e[1]||(e[1]=N(()=>{},["prevent"])),onDrop:N(K,["prevent"]),class:"border-2 border-dashed border-slate-300 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all duration-200"},[...e[2]||(e[2]=[A('<div class="flex flex-col items-center space-y-4" data-v-93a6a55a><svg class="w-12 h-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-93a6a55a><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-93a6a55a></path></svg><div data-v-93a6a55a><p class="text-lg font-semibold text-slate-700" data-v-93a6a55a>Click to upload or drag and drop</p><p class="text-sm text-slate-500 mt-1" data-v-93a6a55a>Supports MP4, MOV, AVI, WMV, MKV up to 1GB</p><p class="text-xs text-slate-400 mt-2" data-v-93a6a55a>Fast chunked upload with compression</p></div></div>',1)])],32)])):S("",!0),n.value&&!d.value&&!u.value?(h(),m("div",ae,[t("div",se,[t("div",oe,[e[3]||(e[3]=t("div",{class:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})])],-1)),t("div",null,[t("p",le,i(n.value.name),1),t("p",ne,i(y(n.value.size)),1)])]),t("div",{class:"flex items-center space-x-2"},[t("button",{onClick:P,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200"}," Start Upload "),t("button",{onClick:q,class:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors duration-200"}," Cancel ")])])])):S("",!0),d.value?(h(),m("div",re,[t("div",ie,[t("div",de,[t("div",ue,[e[5]||(e[5]=t("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},[t("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})])],-1)),t("div",null,[e[4]||(e[4]=t("p",{class:"font-semibold text-slate-800"},"Uploading Video...",-1)),t("p",ce,i(x.value)+"/"+i(k.value)+" chunks â€¢ "+i(T.value),1)])]),t("button",{onClick:U,class:"text-red-600 hover:text-red-700 text-sm font-medium"}," Cancel ")]),t("div",pe,[t("div",ve,[e[6]||(e[6]=t("span",{class:"text-slate-600"},"Progress",-1)),t("span",fe,i(g.value.toFixed(1))+"%",1)]),t("div",me,[t("div",{class:"bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-300",style:Y({width:g.value+"%"})},null,4)]),t("div",he,[t("span",null,i(y(f.value))+" / "+i(y(w.value)),1),t("span",null,"ETA: "+i(C.value),1)])])])])):S("",!0),u.value?(h(),m("div",ge,[t("div",{class:"bg-green-50 border border-green-200 rounded-xl p-6"},[e[7]||(e[7]=A('<div class="flex items-center space-x-3" data-v-93a6a55a><div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" data-v-93a6a55a><svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-93a6a55a><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-93a6a55a></path></svg></div><div data-v-93a6a55a><p class="font-semibold text-green-800" data-v-93a6a55a>Upload Successful!</p><p class="text-sm text-green-600" data-v-93a6a55a>Video uploaded and processed successfully</p></div></div>',1)),t("button",{onClick:$,class:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium"}," Upload Another Video ")])])):S("",!0),r.value?(h(),m("div",xe,[t("div",ke,[t("div",we,[e[9]||(e[9]=t("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.126 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t("div",null,[e[8]||(e[8]=t("p",{class:"font-medium text-red-800"},"Upload Failed",-1)),t("p",ye,i(r.value),1)])]),t("button",{onClick:H,class:"mt-2 text-sm text-red-700 hover:text-red-800 font-medium"}," Try Again ")])])):S("",!0)]))}},_e=Z(be,[["__scopeId","data-v-93a6a55a"]]);export{_e as C};
