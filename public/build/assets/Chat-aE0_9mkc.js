import{r as u,A as N,m as w,E as A,c as n,o as r,a as y,u as k,h as E,w as _,b as e,t as l,n as m,j as d,l as G,i as I,F as C,f as D,q as O,d as U,e as V,v as $,K as q}from"./app-BwyiUpTk.js";import{_ as F}from"./DashboardLayout-lZDm8la_.js";const K={class:"max-w-6xl mx-auto"},z={class:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl border border-slate-200/50 mb-6"},L={class:"p-6"},P={class:"flex items-center justify-between"},H={class:"flex items-center space-x-4"},J={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold"},Q={class:"text-xl font-semibold text-slate-800"},R={class:"flex items-center space-x-2 mt-1"},X={class:"text-xs text-slate-500"},W={class:"flex items-center space-x-3"},Y={class:"mt-4 p-4 bg-slate-50 rounded-xl"},Z={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},ee={class:"font-semibold"},te={class:"font-mono text-xs"},se={key:0},ae={class:"font-semibold"},oe={key:1},le={class:"font-semibold"},ne={class:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl border border-slate-200/50 flex flex-col h-[70vh]"},re={key:0,class:"space-y-4"},ie={key:0,class:"text-xs opacity-80 mb-1 font-semibold"},de={class:"whitespace-pre-wrap"},ce={key:1,class:"flex-1 flex items-center justify-center"},ue={key:2,class:"flex justify-end"},me={class:"p-6 border-t border-slate-200"},he={class:"flex-1"},xe=["disabled"],ge=["disabled"],be={key:0,class:"mt-3 text-center"},ve={__name:"Chat",props:{auth:Object,chat:Object,messages:Array},setup(t){const c=t;c.auth?.user;const i=u(""),g=u(null),h=u(null),x=u(!1),b=u(null),v=o=>new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),S=o=>o.sender_type==="user"?"justify-start":o.sender_type==="agent"?"justify-end":"justify-center",j=o=>o.sender_type==="user"?"bg-slate-100 text-slate-800 rounded-br-sm":o.sender_type==="agent"?"bg-blue-500 text-white rounded-bl-sm":"bg-amber-100 text-amber-800 border border-amber-200 italic",p=async()=>{if(!i.value.trim())return;const o=i.value.trim();i.value="",x.value=!0;try{const a=await(await fetch(route("complaints.message",c.chat.session_id),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({message:o,message_type:"text"})})).json();if(!a.message)throw new Error("Failed to send message");c.messages&&c.messages.push({id:a.message.id,message:a.message.message,sender_type:a.message.sender_type,sender_name:a.message.user?.name,created_at:a.message.created_at,user:a.message.user}),f()}catch(s){console.error("Error sending message:",s),i.value=o}finally{x.value=!1}},T=()=>{confirm("Are you sure you want to close this chat?")&&w.post(route("complaints.close",c.chat.session_id))},f=()=>{q(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})};N(()=>{f(),g.value&&g.value.focus(),b.value=setInterval(()=>{w.reload({only:["messages"],preserveScroll:!0,onSuccess:()=>{f()}})},2e3)}),A(()=>{b.value&&clearInterval(b.value)});const M=o=>({low:"bg-green-100 text-green-700",normal:"bg-blue-100 text-blue-700",high:"bg-orange-100 text-orange-700",urgent:"bg-red-100 text-red-700"})[o]||"bg-gray-100 text-gray-700",B=o=>({waiting:"bg-yellow-100 text-yellow-700",active:"bg-green-100 text-green-700",closed:"bg-gray-100 text-gray-700"})[o]||"bg-gray-100 text-gray-700";return(o,s)=>(r(),n(C,null,[y(k(E),{title:`Chat with ${t.chat.user?.name||t.chat.user_name||"Guest"}`},null,8,["title"]),y(F,{title:`Chat with ${t.chat.user?.name||t.chat.user_name||"Guest"}`,subtitle:`${t.chat.category||"General Support"} - ${t.chat.priority} priority`},{default:_(()=>[e("div",K,[e("div",z,[e("div",L,[e("div",P,[e("div",H,[e("div",J,l((t.chat.user?.name||t.chat.user_name||"G").charAt(0).toUpperCase()),1),e("div",null,[e("h2",Q,l(t.chat.user?.name||t.chat.user_name||"Guest User"),1),e("div",R,[e("span",{class:m([B(t.chat.status),"px-2 py-1 text-xs font-semibold rounded-full"])},l(t.chat.status),3),e("span",{class:m([M(t.chat.priority),"px-2 py-1 text-xs font-semibold rounded-full"])},l(t.chat.priority),3),e("span",X,l(t.chat.category||"General Support"),1)])])]),e("div",W,[t.chat.status!=="closed"?(r(),n("button",{key:0,onClick:T,class:"px-4 py-2 bg-red-500 text-white text-sm font-semibold rounded-xl hover:bg-red-600 transition-colors duration-200"}," Close Chat ")):d("",!0),y(k(G),{href:o.route("complaints.index"),class:"px-4 py-2 bg-slate-500 text-white text-sm font-semibold rounded-xl hover:bg-slate-600 transition-colors duration-200"},{default:_(()=>[...s[1]||(s[1]=[I(" Back to Dashboard ",-1)])]),_:1},8,["href"])])]),e("div",Y,[e("div",Z,[e("div",null,[s[2]||(s[2]=e("span",{class:"text-slate-500"},"Started:",-1)),e("p",ee,l(v(t.chat.started_at)),1)]),e("div",null,[s[3]||(s[3]=e("span",{class:"text-slate-500"},"Session ID:",-1)),e("p",te,l(t.chat.session_id.substring(0,8))+"...",1)]),t.chat.user_email?(r(),n("div",se,[s[4]||(s[4]=e("span",{class:"text-slate-500"},"Email:",-1)),e("p",ae,l(t.chat.user_email),1)])):d("",!0),t.chat.queue_position?(r(),n("div",oe,[s[5]||(s[5]=e("span",{class:"text-slate-500"},"Queue Position:",-1)),e("p",le,"#"+l(t.chat.queue_position),1)])):d("",!0)])])])]),e("div",ne,[e("div",{ref_key:"messagesContainer",ref:h,class:"flex-1 p-6 overflow-y-auto space-y-4"},[t.messages?.length?(r(),n("div",re,[(r(!0),n(C,null,D(t.messages,a=>(r(),n("div",{key:a.id,class:m(["flex",S(a)])},[e("div",{class:m(["max-w-xs lg:max-w-md px-4 py-3 rounded-2xl text-sm",j(a)])},[a.sender_type==="agent"&&a.sender_name?(r(),n("div",ie,l(a.sender_name),1)):d("",!0),e("div",de,l(a.message),1),e("div",{class:m(["text-xs mt-2 opacity-70",a.sender_type==="agent"?"text-blue-100":"text-slate-500"])},l(v(a.created_at)),3)],2)],2))),128))])):(r(),n("div",ce,[...s[6]||(s[6]=[e("div",{class:"text-center text-slate-500"},[e("svg",{class:"w-16 h-16 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.645C3.395 15.1 3 13.558 3 12c0-4.97 4.03-9 9-9s9 4.03 9 9z"})]),e("p",null,"No messages yet. Start the conversation!")],-1)])])),x.value?(r(),n("div",ue,[...s[7]||(s[7]=[e("div",{class:"bg-blue-400 text-white px-4 py-2 rounded-2xl rounded-bl-sm text-sm"},[e("span",{class:"animate-pulse"},"Sending...")],-1)])])):d("",!0)],512),e("div",me,[e("form",{onSubmit:O(p,["prevent"]),class:"flex items-center space-x-4"},[e("div",he,[U(e("input",{ref_key:"messageInput",ref:g,"onUpdate:modelValue":s[0]||(s[0]=a=>i.value=a),type:"text",placeholder:"Type your message...",disabled:t.chat.status==="closed",class:"w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-100 disabled:cursor-not-allowed",onKeyup:V(p,["enter"])},null,40,xe),[[$,i.value]])]),e("button",{type:"submit",disabled:!i.value.trim()||x.value||t.chat.status==="closed",class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[...s[8]||(s[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,ge)],32),t.chat.status==="closed"?(r(),n("div",be,[...s[9]||(s[9]=[e("span",{class:"text-sm text-slate-500"},"This chat has been closed",-1)])])):d("",!0)])])])]),_:1},8,["title","subtitle"])],64))}};export{ve as default};
