import{r as x,p as B,s as O,z as q,C as K,c as o,o as r,a as j,u as n,h as Y,w as z,b as e,j as d,l as J,t as i,F as y,f as C,n as p,q as $,d as R,e as P,v as Q,g as W,L as X,B as T}from"./app--fhtQyYk.js";import{_ as Z}from"./DashboardLayout-DwXMIeFU.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"max-w-6xl mx-auto"},se={class:"bg-white/80 backdrop-blur-sm rounded-t-3xl p-6 shadow-xl border border-slate-200/50 border-b-0"},oe={class:"flex items-center justify-between"},re={class:"flex items-center space-x-4"},le={class:"flex items-center space-x-3"},ne={class:"w-10 h-10 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center text-white"},ie={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ae={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},de={class:"font-bold text-slate-800"},ue={class:"flex items-center space-x-2 text-sm text-slate-500"},ce={key:0,class:"inline-flex items-center px-2 py-1 text-xs font-medium bg-indigo-100 text-indigo-700 rounded-full"},me={class:"flex items-center space-x-2"},fe={class:"bg-white/80 backdrop-blur-sm shadow-xl border-x border-slate-200/50 h-[600px] flex flex-col"},ve={key:0,class:"flex justify-center py-2"},xe={class:"px-3 py-1 text-xs font-medium text-slate-500 bg-slate-100 rounded-full"},pe={key:0,class:"flex-shrink-0"},he=["src","alt"],be={class:"flex flex-col"},ge={key:0,class:"text-sm font-semibold text-slate-700"},ye={class:"text-xs text-slate-400"},we={class:"font-medium text-slate-600"},_e={class:"text-slate-500"},ke=["onClick"],Me={key:0,class:"flex-1 flex items-center justify-center"},je={class:"border-t border-slate-200/50 p-4"},Ce={key:0,class:"mb-3 p-3 bg-slate-50 rounded-lg border-l-4 border-indigo-500"},De={class:"flex items-center justify-between"},Se={class:"text-sm font-medium text-slate-600"},Ge={class:"text-sm text-slate-500"},Be={class:"flex-1 relative"},ze=["disabled"],$e={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Te={class:"fixed inset-0 transition-opacity","aria-hidden":"true"},Ae={class:"inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ue={class:"bg-white px-4 pt-5 pb-4 sm:p-6"},Ee={class:"sm:flex sm:items-start"},Ie={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Le={class:"max-h-96 overflow-y-auto"},Ve={class:"flex items-center space-x-3"},He=["src","alt"],Fe={class:"font-medium text-gray-900"},Ne={class:"text-sm text-gray-500"},Oe={key:0,class:"text-xs font-medium text-indigo-600 capitalize"},qe={key:0,class:"flex items-center space-x-2"},Ke=["onClick"],Ye={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Je={key:1,class:"fixed inset-0 z-50 overflow-y-auto"},Pe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Qe={class:"fixed inset-0 transition-opacity","aria-hidden":"true"},We={class:"inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Xe={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ze={class:"sm:flex sm:items-start"},et={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},tt=["value"],st={key:0,class:"mt-1 text-sm text-red-600"},ot={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},rt=["disabled"],lt={key:0},nt={key:1},it={__name:"Show",props:{auth:Object,chatGroup:Object,messages:Object,userRole:String},setup(u){const m=u,c=m.auth?.user||{name:"Guest",role:"guest"},b=x(""),w=x(null),h=x(null);x(!1);const f=x(m.messages.data||[]),_=x(!1),g=x(!1),D=x([]),v=B({user_id:""}),S=O(()=>m.userRole==="admin"||m.userRole==="moderator"),k=()=>{X(()=>{w.value&&(w.value.scrollTop=w.value.scrollHeight)})},G=async()=>{if(!b.value.trim())return;const l={message:b.value.trim(),message_type:"text",reply_to:h.value?.id||null};try{const s=await T.post(route("chat.storeMessage",m.chatGroup.id),l);s.data.success&&(f.value.push(s.data.message),b.value="",h.value=null,k())}catch(s){console.error("Error sending message:",s)}},A=l=>{h.value=l,document.getElementById("message-input")?.focus()},U=()=>{h.value=null},E=l=>new Date(l).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),I=l=>{const s=new Date(l),t=new Date,a=new Date(t);return a.setDate(a.getDate()-1),s.toDateString()===t.toDateString()?"Today":s.toDateString()===a.toDateString()?"Yesterday":s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},L=(l,s)=>{if(!s)return!0;const t=new Date(l.created_at).toDateString(),a=new Date(s.created_at).toDateString();return t!==a},M=(l,s)=>{if(!s)return!1;const t=new Date(l.created_at)-new Date(s.created_at),a=300*1e3;return l.user_id===s.user_id&&t<a},V=async()=>{try{const l=await T.get("/api/users");D.value=l.data.filter(s=>!m.chatGroup.users.some(t=>t.id===s.id))}catch(l){console.error("Error fetching users:",l)}},H=()=>{v.post(route("chat.addMember",m.chatGroup.id),{preserveScroll:!0,onSuccess:()=>{g.value=!1,v.reset()},onError:l=>{console.error("Add member errors:",l)}})},F=l=>{confirm(`Are you sure you want to remove ${l.name} from this group?`)&&B({}).delete(route("chat.removeMember",[m.chatGroup.id,l.id]),{preserveScroll:!0,onSuccess:()=>{},onError:t=>{console.error("Remove member errors:",t)}})},N=()=>{V(),g.value=!0};return q(()=>{k()}),K(()=>f.value.length,()=>{k()}),(l,s)=>(r(),o(y,null,[j(n(Y),{title:`${u.chatGroup.name} - Chat`},null,8,["title"]),j(Z,{title:u.chatGroup.name,subtitle:`${u.chatGroup.users_count} members`},{default:z(()=>[e("div",te,[e("div",se,[e("div",oe,[e("div",re,[j(n(J),{href:l.route("chat.index"),class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors duration-200"},{default:z(()=>[...s[7]||(s[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1},8,["href"]),e("div",le,[e("div",ne,[u.chatGroup.type==="subject"?(r(),o("svg",ie,[...s[8]||(s[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13.447m0-13.447l6.818-4.757M12 6.253l-6.818-4.757m6.818 4.757l-.547 4.197"},null,-1)])])):(r(),o("svg",ae,[...s[9]||(s[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"},null,-1)])]))]),e("div",null,[e("h1",de,i(u.chatGroup.name),1),e("div",ue,[e("span",null,i(u.chatGroup.users_count)+" members",1),u.chatGroup.subject?(r(),o("span",ce,i(u.chatGroup.subject.name),1)):d("",!0)])])])]),e("div",me,[e("button",{onClick:s[0]||(s[0]=t=>_.value=!0),class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors duration-200",title:"View Members"},[...s[10]||(s[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm6 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])]),S.value?(r(),o("button",{key:0,onClick:N,class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors duration-200",title:"Add Member"},[...s[11]||(s[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1)])])):d("",!0),s[12]||(s[12]=e("button",{class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors duration-200",title:"Group Info"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])])]),e("div",fe,[e("div",{ref_key:"messagesContainer",ref:w,class:"flex-1 overflow-y-auto p-6 space-y-4"},[(r(!0),o(y,null,C(f.value,(t,a)=>(r(),o(y,{key:t.id},[L(t,f.value[a-1])?(r(),o("div",ve,[e("span",xe,i(I(t.created_at)),1)])):d("",!0),e("div",{class:p(["flex",t.user_id===n(c).id?"justify-end":"justify-start"])},[e("div",{class:p(["max-w-lg flex",t.user_id===n(c).id?"flex-row-reverse":"flex-row",M(t,f.value[a-1])?"mt-1":"mt-4"])},[M(t,f.value[a-1])?(r(),o("div",{key:1,class:p(t.user_id===n(c).id?"mr-11":"ml-11")},null,2)):(r(),o("div",pe,[e("img",{src:t.user.profile_photo_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.user.name)}&background=6366f1&color=ffffff`,alt:t.user.name,class:p(["w-8 h-8 rounded-full",t.user_id===n(c).id?"ml-3":"mr-3"])},null,10,he)])),e("div",be,[M(t,f.value[a-1])?d("",!0):(r(),o("div",{key:0,class:p(["flex items-center space-x-2 mb-1",t.user_id===n(c).id?"justify-end":"justify-start"])},[t.user_id!==n(c).id?(r(),o("span",ge,i(t.user.name),1)):d("",!0),e("span",ye,i(E(t.created_at)),1)],2)),t.reply_to?(r(),o("div",{key:1,class:p(["mb-2 p-2 rounded-lg border-l-4 border-slate-300 bg-slate-50 text-sm",t.user_id===n(c).id?"mr-0":"ml-0"])},[e("div",we,i(t.reply_to.user.name),1),e("div",_e,i(t.reply_to.message),1)],2)):d("",!0),e("div",{class:p(["px-4 py-2 rounded-2xl max-w-sm break-words",t.user_id===n(c).id?"bg-indigo-500 text-white rounded-br-md":"bg-slate-100 text-slate-800 rounded-bl-md"])},i(t.message),3),e("div",{class:p(["flex items-center space-x-2 mt-1 opacity-0 hover:opacity-100 transition-opacity duration-200",t.user_id===n(c).id?"justify-end":"justify-start"])},[e("button",{onClick:at=>A(t),class:"p-1 text-slate-400 hover:text-slate-600 rounded",title:"Reply"},[...s[13]||(s[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])],8,ke)],2)])],2)],2)],64))),128)),f.value.length===0?(r(),o("div",Me,[...s[14]||(s[14]=[e("div",{class:"text-center"},[e("div",{class:"w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-2xl flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.645C5.525 14.88 7.42 16 9 16c2.31 0 4.792-.88 6-2.5l-.5-1.5"})])]),e("h3",{class:"text-lg font-semibold text-slate-600 mb-2"},"No messages yet"),e("p",{class:"text-slate-500"},"Be the first to start the conversation!")],-1)])])):d("",!0)],512),e("div",je,[h.value?(r(),o("div",Ce,[e("div",De,[e("div",null,[e("div",Se,"Replying to "+i(h.value.user.name),1),e("div",Ge,i(h.value.message),1)]),e("button",{onClick:U,class:"p-1 text-slate-400 hover:text-slate-600 rounded"},[...s[15]||(s[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):d("",!0),e("form",{onSubmit:$(G,["prevent"]),class:"flex items-center space-x-3"},[e("div",Be,[R(e("input",{id:"message-input","onUpdate:modelValue":s[1]||(s[1]=t=>b.value=t),type:"text",placeholder:"Type your message...",class:"w-full bg-slate-100/70 backdrop-blur-sm px-4 py-3 pr-12 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:bg-white transition-all duration-200",onKeydown:P(G,["enter"])},null,544),[[Q,b.value]]),e("button",{type:"submit",disabled:!b.value.trim(),class:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...s[16]||(s[16]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,ze)])],32)])])]),_.value?(r(),o("div",$e,[e("div",Re,[e("div",Te,[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75",onClick:s[2]||(s[2]=t=>_.value=!1)})]),e("div",Ae,[e("div",Ue,[e("div",Ee,[e("div",Ie,[s[17]||(s[17]=e("h3",{class:"text-lg leading-6 font-bold text-gray-900 mb-4"},"Group Members",-1)),e("div",Le,[(r(!0),o(y,null,C(u.chatGroup.users,t=>(r(),o("div",{key:t.id,class:"flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0"},[e("div",Ve,[e("img",{src:t.profile_photo_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=6366f1&color=ffffff`,alt:t.name,class:"w-10 h-10 rounded-full"},null,8,He),e("div",null,[e("div",Fe,i(t.name),1),e("div",Ne,i(t.email),1),t.pivot.role!=="member"?(r(),o("div",Oe,i(t.pivot.role),1)):d("",!0)])]),S.value&&t.id!==u.chatGroup.created_by&&t.id!==n(c).id?(r(),o("div",qe,[e("button",{onClick:a=>F(t),class:"text-red-600 hover:text-red-800 text-sm font-medium"}," Remove ",8,Ke)])):d("",!0)]))),128))])])])]),e("div",Ye,[e("button",{onClick:s[3]||(s[3]=t=>_.value=!1),class:"w-full inline-flex justify-center rounded-2xl border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:w-auto sm:text-sm"}," Close ")])])])])):d("",!0),g.value?(r(),o("div",Je,[e("div",Pe,[e("div",Qe,[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75",onClick:s[4]||(s[4]=t=>g.value=!1)})]),e("div",We,[e("form",{onSubmit:$(H,["prevent"])},[e("div",Xe,[e("div",Ze,[e("div",et,[s[20]||(s[20]=e("h3",{class:"text-lg leading-6 font-bold text-gray-900 mb-4"},"Add Member to Group",-1)),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select User",-1)),R(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>n(v).user_id=t),required:"",class:"w-full border-gray-300 rounded-2xl focus:ring-indigo-500 focus:border-indigo-500"},[s[18]||(s[18]=e("option",{value:""},"Choose a user...",-1)),(r(!0),o(y,null,C(D.value,t=>(r(),o("option",{key:t.id,value:t.id},i(t.name)+" ("+i(t.email)+") ",9,tt))),128))],512),[[W,n(v).user_id]]),n(v).errors.user_id?(r(),o("div",st,i(n(v).errors.user_id),1)):d("",!0)])])])]),e("div",ot,[e("button",{type:"submit",disabled:n(v).processing,class:"w-full inline-flex justify-center rounded-2xl border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"},[n(v).processing?(r(),o("span",lt,"Adding...")):(r(),o("span",nt,"Add Member"))],8,rt),e("button",{type:"button",onClick:s[6]||(s[6]=t=>g.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-2xl border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):d("",!0)]),_:1},8,["title","subtitle"])],64))}},mt=ee(it,[["__scopeId","data-v-bb8f5f41"]]);export{mt as default};
